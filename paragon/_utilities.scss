// ========================================
// UTILITY COMPONENTS AND CLASSES
// ========================================

// Modern utility components for Open edX MFEs
// These utilities complement the brand styling system

// ========================================
// LOADING STATES
// ========================================

.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4rem 2rem;
  text-align: center;
  
  .loading-spinner {
    width: 3rem;
    height: 3rem;
    border: 3px solid rgba($brand-primary, 0.2);
    border-top: 3px solid $brand-primary;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1.5rem;
  }
  
  .loading-text {
    color: $gray-600;
    font-size: $font-size-lg;
    font-weight: $font-weight-medium;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// Skeleton loading
.skeleton {
  background: linear-gradient(90deg, $gray-200 25%, $gray-100 50%, $gray-200 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: $border-radius;
  
  &.skeleton-text {
    height: 1rem;
    margin-bottom: 0.5rem;
    
    &.skeleton-title {
      height: 1.5rem;
      width: 60%;
    }
    
    &.skeleton-paragraph {
      height: 1rem;
      
      &:nth-child(1) { width: 100%; }
      &:nth-child(2) { width: 85%; }
      &:nth-child(3) { width: 70%; }
    }
  }
  
  &.skeleton-avatar {
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
  }
  
  &.skeleton-card {
    height: 200px;
    width: 100%;
  }
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

// ========================================
// ALERT COMPONENTS
// ========================================

.alert-modern {
  border: none;
  border-radius: $border-radius-lg;
  padding: 1rem 1.5rem;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  box-shadow: $box-shadow-sm;
  
  .alert-icon {
    width: 1.5rem;
    height: 1.5rem;
    flex-shrink: 0;
    margin-top: 0.125rem;
  }
  
  .alert-content {
    flex: 1;
    
    .alert-title {
      font-weight: $font-weight-semibold;
      margin-bottom: 0.25rem;
    }
    
    .alert-message {
      font-size: $font-size-sm;
      line-height: $line-height-relaxed;
      margin: 0;
    }
  }
  
  .alert-dismiss {
    background: none;
    border: none;
    color: inherit;
    opacity: 0.6;
    cursor: pointer;
    padding: 0;
    width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    
    &:hover {
      opacity: 1;
    }
  }
  
  &.alert-success {
    background: rgba($success, 0.1);
    color: $success-dark;
    border-left: 4px solid $success;
  }
  
  &.alert-warning {
    background: rgba($warning, 0.1);
    color: $warning-dark;
    border-left: 4px solid $warning;
  }
  
  &.alert-danger {
    background: rgba($danger, 0.1);
    color: $danger-dark;
    border-left: 4px solid $danger;
  }
  
  &.alert-info {
    background: rgba($info, 0.1);
    color: $info-dark;
    border-left: 4px solid $info;
  }
  
  &.alert-brand {
    background: rgba($brand-primary, 0.1);
    color: darken($brand-primary, 20%);
    border-left: 4px solid $brand-primary;
  }
}

// ========================================
// BADGE COMPONENTS
// ========================================

.badge-modern {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.375rem 0.75rem;
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  border-radius: $border-radius-pill;
  text-transform: uppercase;
  letter-spacing: 0.025em;
  
  &.badge-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }
  
  &.badge-lg {
    padding: 0.5rem 1rem;
    font-size: $font-size-base;
  }
  
  &.badge-primary {
    background: $brand-primary;
    color: white;
  }
  
  &.badge-secondary {
    background: $brand-secondary;
    color: $gray-900;
  }
  
  &.badge-success {
    background: $success;
    color: white;
  }
  
  &.badge-warning {
    background: $warning;
    color: $gray-900;
  }
  
  &.badge-danger {
    background: $danger;
    color: white;
  }
  
  &.badge-info {
    background: $info;
    color: white;
  }
  
  &.badge-light {
    background: $gray-100;
    color: $gray-800;
  }
  
  &.badge-dark {
    background: $gray-800;
    color: white;
  }
  
  // Outline variants
  &.badge-outline-primary {
    background: transparent;
    color: $brand-primary;
    border: 1px solid $brand-primary;
  }
  
  &.badge-outline-secondary {
    background: transparent;
    color: $brand-secondary;
    border: 1px solid $brand-secondary;
  }
  
  &.badge-outline-success {
    background: transparent;
    color: $success;
    border: 1px solid $success;
  }
  
  &.badge-outline-warning {
    background: transparent;
    color: $warning;
    border: 1px solid $warning;
  }
  
  &.badge-outline-danger {
    background: transparent;
    color: $danger;
    border: 1px solid $danger;
  }
  
  &.badge-outline-info {
    background: transparent;
    color: $info;
    border: 1px solid $info;
  }
}

// ========================================
// PROGRESS COMPONENTS
// ========================================

.progress-modern {
  height: 0.75rem;
  background: $gray-200;
  border-radius: $border-radius-pill;
  overflow: hidden;
  position: relative;
  
  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, $brand-primary, $brand-secondary);
    border-radius: $border-radius-pill;
    transition: width 0.6s ease;
    position: relative;
    
    &::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.2) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0.2) 75%,
        transparent 75%,
        transparent
      );
      background-size: 1rem 1rem;
      animation: progress-stripes 1s linear infinite;
    }
  }
  
  &.progress-sm {
    height: 0.5rem;
  }
  
  &.progress-lg {
    height: 1rem;
  }
  
  &.progress-success .progress-bar {
    background: linear-gradient(90deg, $success, lighten($success, 10%));
  }
  
  &.progress-warning .progress-bar {
    background: linear-gradient(90deg, $warning, lighten($warning, 10%));
  }
  
  &.progress-danger .progress-bar {
    background: linear-gradient(90deg, $danger, lighten($danger, 10%));
  }
  
  &.progress-info .progress-bar {
    background: linear-gradient(90deg, $info, lighten($info, 10%));
  }
}

@keyframes progress-stripes {
  0% { background-position: 1rem 0; }
  100% { background-position: 0 0; }
}

// Circular progress
.progress-circle {
  position: relative;
  width: 4rem;
  height: 4rem;
  
  .progress-circle-svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
    
    .progress-circle-bg {
      fill: none;
      stroke: $gray-200;
      stroke-width: 4;
    }
    
    .progress-circle-fill {
      fill: none;
      stroke: $brand-primary;
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.6s ease;
    }
  }
  
  .progress-circle-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: $font-size-sm;
    font-weight: $font-weight-bold;
    color: $brand-primary;
  }
  
  &.progress-circle-sm {
    width: 2.5rem;
    height: 2.5rem;
    
    .progress-circle-text {
      font-size: 0.75rem;
    }
  }
  
  &.progress-circle-lg {
    width: 6rem;
    height: 6rem;
    
    .progress-circle-text {
      font-size: $font-size-lg;
    }
  }
}

// ========================================
// TOOLTIP ENHANCEMENTS
// ========================================

.tooltip-modern {
  .tooltip-inner {
    background: $gray-900;
    color: white;
    border-radius: $border-radius;
    padding: 0.5rem 0.75rem;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    box-shadow: $box-shadow-lg;
  }
  
  &.bs-tooltip-top .tooltip-arrow::before {
    border-top-color: $gray-900;
  }
  
  &.bs-tooltip-right .tooltip-arrow::before {
    border-right-color: $gray-900;
  }
  
  &.bs-tooltip-bottom .tooltip-arrow::before {
    border-bottom-color: $gray-900;
  }
  
  &.bs-tooltip-left .tooltip-arrow::before {
    border-left-color: $gray-900;
  }
}

// ========================================
// EMPTY STATES
// ========================================

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  
  .empty-state-icon {
    width: 4rem;
    height: 4rem;
    margin: 0 auto 2rem;
    background: rgba($brand-primary, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: $brand-primary;
    font-size: $font-size-2xl;
  }
  
  .empty-state-title {
    font-size: $font-size-xl;
    font-weight: $font-weight-bold;
    color: $gray-900;
    margin-bottom: 1rem;
  }
  
  .empty-state-description {
    color: $gray-600;
    font-size: $font-size-base;
    line-height: $line-height-relaxed;
    margin-bottom: 2rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .empty-state-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }
}

// ========================================
// SEARCH COMPONENTS
// ========================================

.search-modern {
  position: relative;
  
  .search-input {
    height: 3rem;
    padding: 0.75rem 3rem 0.75rem 1rem;
    border: 2px solid $gray-200;
    border-radius: $border-radius-lg;
    font-family: $font-family-base;
    transition: all 0.2s ease-in-out;
    width: 100%;
    
    &:focus {
      border-color: $brand-primary;
      box-shadow: 0 0 0 3px rgba($brand-primary, 0.1);
      outline: none;
    }
    
    &::placeholder {
      color: $gray-400;
    }
  }
  
  .search-icon {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: $gray-400;
    pointer-events: none;
  }
  
  .search-clear {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: $gray-400;
    cursor: pointer;
    padding: 0;
    width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    
    &:hover {
      color: $gray-600;
      background: $gray-100;
    }
  }
  
  .search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid $gray-200;
    border-radius: $border-radius-lg;
    box-shadow: $box-shadow-lg;
    z-index: 1000;
    margin-top: 0.25rem;
    max-height: 300px;
    overflow-y: auto;
    
    .suggestion-item {
      padding: 0.75rem 1rem;
      cursor: pointer;
      border-bottom: 1px solid $gray-100;
      transition: background-color 0.15s ease;
      
      &:last-child {
        border-bottom: none;
      }
      
      &:hover,
      &.active {
        background: $gray-50;
      }
      
      .suggestion-text {
        font-weight: $font-weight-medium;
        color: $gray-900;
      }
      
      .suggestion-meta {
        font-size: $font-size-sm;
        color: $gray-600;
        margin-top: 0.25rem;
      }
    }
  }
}

// ========================================
// RESPONSIVE UTILITIES
// ========================================

// Hide/show utilities
.d-mobile-none {
  @media (max-width: 767px) {
    display: none !important;
  }
}

.d-desktop-none {
  @media (min-width: 768px) {
    display: none !important;
  }
}

.d-tablet-none {
  @media (min-width: 768px) and (max-width: 1023px) {
    display: none !important;
  }
}

// Text utilities
.text-truncate-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.text-truncate-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// Animation utilities
.animate-fade-in {
  animation: fadeIn 0.3s ease-in-out;
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out;
}

.animate-scale-in {
  animation: scaleIn 0.2s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(1rem);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

// ========================================
// ACCESSIBILITY UTILITIES
// ========================================

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.focus-visible {
  &:focus-visible {
    outline: 2px solid $brand-primary;
    outline-offset: 2px;
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  .alert-modern,
  .badge-modern,
  .progress-modern,
  .search-modern .search-input {
    border-width: 2px;
  }
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .loading-spinner,
  .skeleton,
  .progress-modern .progress-bar::after,
  .animate-fade-in,
  .animate-slide-up,
  .animate-scale-in {
    animation: none;
  }
  
  .progress-modern .progress-bar,
  .progress-circle .progress-circle-fill {
    transition: none;
  }
}
